# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
---
## Описание базового кода

#### 1. Класс `Api`

Представляет базовый класс для выполнения HTTP-запросов к внешнему API.

###### Конструктор принимает такие аргументы:
- `baseUrl: string` - базовый URL адрес для запросов.
- `options: RequestInit` - настройки запроса по умолчанию.

###### Используемые методы:

`handleResponse(response: Response): Promise<object>`

Защищенный метод. Обрабатывает ответ от сервера и возвращает либо объект данных, либо отклоняет промис с сообщением об ошибке.


`get(uri: string): Promise<object>`

Выполняет GET запрос к URI и возвращает промис с данными ответа.


`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>`

Выполняет POST запрос с переданным URI, данными и методом. Возвращает промис с данными ответа.


#### 2. Класс `EventEmitter`
Представляет класс для управления событиями и подписчиками. Может установить и снять слушатели событий, вызвать слушателей при возникновении события.

###### Свойства:

- `_events: Map<EventName, Set<Subscriber>>` 

Приватное свойство, где сохраняются сведения о том, какие события происходят и кто на них подписан.


###### Используемые методы:

- `on(eventName: EventName, callback: (event: T) => void): void`

Добавляет обработчик для указанного события.


- `off(eventName: EventName, callback: Subscriber): void` 

Удаляет обработчик для указанного события.


- `emit(eventName: string, data?: T): void` 

Вызывает указанное событие, сообщая всем, кто на него подписан, о его наступлении. При этом могут передаваться какие-нибудь данные


- `onAll(callback: (event: EmitterEvent) => void): void` 

Добавляет обработчик, который будет вызываться для всех событий.


- `offAll(): void` 

Удаляет все обработчики событий.


`trigger(eventName: string, context?: Partial<T>): (event: object = {}) => void` 

Создает функцию-триггер, которая вызывает указанное событие с указанным контекстом, когда она вызывается.


---
## Типизация базового кода

#### 1. Тип `ApiListResponse<Type>` 

Является дженериком, представляет структуру ответа API, содержащего список элементов типа `Type`.

###### Свойства:
- `total`: число - общее количество элементов в списке.
- `items`: массив `Type[]`  - список элементов, содержащихся в ответе. Каждый элемент имеет тип `Type`.


#### 2.  Тип `ApiPostMethods = 'POST' | 'PUT' | 'DELETE'`

Представляет методы HTTP-запросов, которые могут быть использованы для отправки данных на сервер.

###### Значения:
- `'POST'`- используется для создания новых данных на сервере.
- `'PUT'`- используется для обновления существующих данных на сервере.
- `'DELETE'`- используется для удаления данных с сервера.


#### 3. Тип `type EmitterEvent

Представляет объект, который содержит информацию о произошедшем событии.
###### Свойства:
- **eventName:** `string` - имя события.
- **data:** `unknown` - дополнительные данные, связанные с событием.


#### 4. Тип `Subscriber`

Представляет функцию-подписчика, которая будет вызвана при возникновении события.


#### 5. Тип `EventName`

Представляет имя события, которое может быть строкой или регулярным выражением.


---
## Описание данных

### Интерфейсы модели данных

#### 1. Интерфейс IProduct 

Представляет конкретный товар доступный для приобретения в интернет-магазине, содержит все свойства, необходимые для описания товара. 

###### Свойства: 
- **id**: `string` уникальный идентификатор товара. 
- **category**: `EProductCategory` - категория товара. 
- **title**: `string` - название товара.
- **description**: `string` (опционально) - описание товара. 
- **image**: `string`- ссылка на изображение товара. 
- **price**: `number` -  цена товара.


#### 2. Интерфейс ICartItem 

Представляет товар, добавленный пользователем в корзину, содержит только необходимые для его представления в корзине поля.

###### Свойства:
- **id**: `string` уникальный идентификатор товара. 
- **title**: `string` - название товара.
- **price**: `number` -  цена товара.


#### 3. Интерфейс ICart

Представляет корзину покупок, необходим для выполнения всех доступных пользователю действий с товарами в корзине. Содержит массив товаров, добавленных пользователем для покупки.

###### Свойства:

- **items**: `ICartItem[]` - массив товаров в корзине.


#### 4. Интерфейс IUserDataForm 

Представляет форму ввода способа оплаты и адреса доставки, необходим для получения этих данных от пользователя.

###### Свойства:
- **payment**: `EPaymentMethod` - метод оплаты заказа.
- **address**: `string` - адрес доставки, куда будет доставлен заказ.


#### 5. Интерфейс IUserContactsForm 

Представляет форму ввода электронной почты и номера телефона,
необходим для получения этих данных от пользователя.

###### Свойства:
- **email**: `string` -  электронная почта пользователя.
- **phone**: `string` - номер телефона пользователя.


#### 6. Интерфейс IOrder

Представляет объект заказа, передаваемый на сервер и содержит все необходимые для заказа данные, обозначенные в его свойствах. Необходим для формирования заказа и отправки его на сервер.

###### Свойства:
- **payment**: `EPaymentMethod`  -  метод оплаты заказа.

- **email**: `string`  -  электронная почта пользователя.

- **phone**: `string`  -  номер телефона пользователя.

- **address**: `string`  - адрес доставки.

- **total**: `number`  - общая стоимость заказа.

- **items**: `IProduct[]` - массив товаров, составляющих заказ.


### 7. Интерфейс IDataState

Представляет состояние данных в приложении, позволяет отобразить каталог товаров на главной странице и работать с процессом оформления заказа: подставлять  значение в форму, валидировать поля ввода данных пользователя. 

###### Свойства:
- **catalog:** `IProduct[]` - каталог товаров для отображения на главной странице. 

- **order:** `IOrder | null` - текущий заказ пользователя или `null`, если заказ не оформлен.


---
### Модели данных

### 1. Класс DataState

Реализует интерфейс IDataState. Содержит методы позволяющие выводить каталог товаров на главную страницу, подставлять значения в обе формы ввода пользовательских данных и валидировать эти формы.

###### Свойства:
- **catalog:** `IProduct[]` - каталог товаров для отображения на главной странице. 

- **order:** `IOrder | null` - текущий заказ пользователя или `null`, если заказ не оформлен. 

###### Используемые методы:

`setCatalog(items: IProduct[]): void`

Используется для вывода каталога товаров на главную страницу.


`setFormField(field: IUserDataForm | IUserContactsForm, value: string): void`

Используется для установки значения в формы ввода данных пользователя и контактной информации.


`validateForm(): void`

Используется для валидации данных, введенных пользователем в форму.


### 2. Класс Product

Реализует интерфейсы IProduct и ICartItem (IProduct с сокращенным количеством полей). Представляет конкретный товар доступный для приобретения в интернет-магазине, содержит все свойства, необходимые для полного описания товара и для сокращенного описания используемого в корзине. Необходим для хранения данных о товаре.

###### Свойства: 
- **id**: `string` уникальный идентификатор товара. 
- **category**: `EProductCategory` - категория товара. 
- **title**: `string` - название товара.
- **description**: `string` (опционально) - описание товара. 
- **image**: `string`- ссылка на изображение товара. 
- **price**: `number` -  цена товара.

Пользователь не может изменять товар, поэтому у данного класса отсутствуют методы.


### 3. Класс Cart 

Реализует интерфейс ICart. Содержит массив добавленных товаров все необходимые методы для работы с товарами в корзине. 

###### Свойства:
- **items**: `ICartItem[]` - массив товаров в корзине.

###### Используемые методы:

- **addToCart(id: string): void**  
  Добавляет товар в корзину по его идентификатору.

- **removeFromCart(id: string): void**  
  Удаляет товар из корзины по его идентификатору.

- **getTotal(prices: number[]): number**  
  Возвращает общую стоимость товаров в корзине, на основе переданных цен товаров.

- **checkTotalCorrect(total: number): boolean**  
  Проверяет корректность общей стоимости корзины. Необходим, чтобы избежать ошибки при попытке купить бесценный товар.

- **clearCart(): void**  
  Очищает корзину от всех товаров при завершении заказа.

- **checkEmpty(): boolean**  
  Проверяет, пуста ли корзина. Необходим для управления кнопкой "Оформить"

- **confirmOrder(): void**  
  Подтверждает заказ для перехода к следующему шагу.


### 4. Класс Order

Реализует интерфейс IOrder . С его помощью создается объект заказа, передаваемый на сервер. Хранит необходимые для формирования заказа данные.

###### Свойства:
- **payment**: `EPaymentMethod`  -  метод оплаты заказа.

- **email**: `string`  -  электронная почта пользователя.

- **phone**: `string`  -  номер телефона пользователя.

- **address**: `string`  - адрес доставки.

- **total**: `number`  - общая стоимость заказа.

- **items**: `IProduct[]` - массив товаров, составляющих заказ.

### 5. Класс UserData

Реализует обе формы ввода пользовательских данных - IUserDataForm и IUserContactsForm. Хранит данные пользователя, полученные через поля форм ввода пользовательских данных. Создан для разделения ответственности с классом Order, содержащим те же поля, но отвечающим непосредственно за заказ.

###### Свойства:
- **phone**: `string`  -  номер телефона пользователя.
- **address**: `string`  - адрес доставки.
- **payment**: `EPaymentMethod`  -  метод оплаты заказа.
- **email**: `string`  -  электронная почта пользователя.
