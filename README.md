# Проектная работа "Веб-ларек"

**Стек:** HTML, SCSS, TS, Webpack

**Структура проекта:**
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

**Важные файлы:**
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
---
## Описание базового кода

#### 1. Класс `Api`

Представляет базовый класс для выполнения HTTP-запросов к внешнему API.

###### Конструктор принимает следующие аргументы:
- `baseUrl: string` - базовый URL адрес для запросов. Строковый тип.
- `options: RequestInit` - настройки запроса по умолчанию. Объект типа RequestInit.

###### Используемые методы:

`handleResponse(response: Response): Promise<object>`

Защищенный метод. Принимает объект типа Response. Обрабатывает ответ от сервера и возвращает либо объект данных, либо отклоняет промис с сообщением об ошибке. 

`get(uri: string): Promise<object>`

Выполняет GET запрос к URI. Принимает URI в виде строки и возвращает промис с данными ответа.


`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>`

Выполняет POST запрос с переданным URI, данными и методом. Принимает URI в виде строки, объект данных и метод типа ApiPostMethods (строковый литерал). Возвращает промис, возвращающий объект.


#### 2. Класс `EventEmitter`
Представляет класс для управления событиями и подписчиками. Может установить и снять слушатели событий, вызвать слушателей при возникновении события.

###### Используемые методы:

- `on(eventName: EventName, callback: (event: T) => void): void`

Добавляет обработчик для указанного события.
Принимает два параметра: 
1. `eventName`: строка - имя события.
2. `callback`: функция обратного вызова, которая принимает один аргумент обобщенного типа `T`, где `T` ограничен типом `object`.
Возвращает тип `void`.


- `off(eventName: EventName, callback: Subscriber): void` 

Удаляет обработчик для указанного события.
Принимает два параметра:
1. `eventName`: строка - имя события.
2. `callback`: объект типа `Subscriber` - это обработчик события, который должен быть удален.
Возвращает тип `void`.

- `emit(eventName: string, data?: T): void` 

Вызывает указанное событие, сообщая всем, кто на него подписан, о его наступлении. При этом могут передаваться какие-нибудь данные.
Принимает два параметра:
1. `eventName`: строка - имя события.
2. `data`: объект типа `T` или `undefined` (необязательный параметр) - данные, необходимые для вызова события.
Возвращает тип `void`.

- `onAll(callback: (event: EmitterEvent) => void): void` 

Добавляет обработчик, который будет вызываться для всех событий.
Принимает функцию обратного вызова, которая принимает объект типа `EmitterEvent`.
Возвращает тип `void`.

- `offAll(): void` 

Удаляет все обработчики событий.
Возвращает тип `void`.

`trigger(eventName: string, context?: Partial<T>): (event: object = {}) => void` 

Создает функцию-триггер, которая вызывает указанное событие с указанным контекстом, когда она вызывается.
Принимает два параметра:
1. `eventName`: строка - имя события.
2. `context`:  объект типа `Partial<T>` (может содержать не все свойства типа `T`) или `undefined` (необязательный параметр) - контекст, который связан с событием. 
Возвращает функцию обратного вызова, которая принимает аргумент типа `object` (но имеет значение по умолчанию `{}` и не возвращает ничего (тип `void`).

---
## Описание данных

Данные, используемые в проекте, представлены интерфейсами IProduct и IOrder. 

#### Интерфейс IProduct 

Представляет конкретный товар, доступный для приобретения в интернет-магазине, содержит все данные, необходимые для описания товара. 

###### Свойства: 

- **id**: `string` уникальный идентификатор товара
- **category**: `string` - категория товара 
- **title**: `string` - название товара
- **description**: `string` - описание товара
- **image**: `string`- ссылка на изображение товара
- **price**: `number|null` -  цена товара
- **inCart?**:`boolean` - добавлен ли товар в корзину
- **cartItemIndex?**: `number` - порядковый номер товара в корзине


#### Интерфейс IOrder

Описывает объект заказа отправляемый на сервер. Содержит массив id товаров, добавленных в заказ, данные покупателя и общую сумму заказа.

###### Свойства:

- **payment**: `string`  -  метод оплаты заказа.
- **email**: `string`  -  электронная почта пользователя.
- **phone**: `string`  -  номер телефона пользователя.
- **address**: `string`  - адрес доставки.
- **total**: `number`  - общая стоимость заказа.
- **items**: `string[]` - массив товаров, составляющих заказ.

## Слой данных 

### Класс ModelData

Содержит основную логику работы с данными в приложении. Хранит массив товаров каталога, массив товаров корзины, данные заказа. Содержит все методы изменяющие данные в приложении.

Поля:

- **catalog:** `IProduct[]` - массив товаров каталога
- **shoppingCart:** `IProduct[]` - массив товаров в корзине
- **order:** `IOrder` - текущий заказ
- **preview:** `string | null` - ID выведенного в модальное окно товара
- **formErrors:** `FormErrors` - объект ошибок валидации

###### Методы: 

- **setCatalog(items: IProduct[])** - позволяет установить каталог товаров
- **setPreview(item: IProduct)** - сохраняет id выбранной карточки
- **addToShoppingCart(item: IProduct)** - добавление товара в корзину
- **removeFromShoppingCart(item: IProduct)** - удаление товара из корзины
- **countShoppingCartItems()** - получение количества товаров добавленных в корзину
- **getTotal()** - получение итоговой суммы заказа
- **clearShoppingCart()** - очистка корзины после завершения заказа
- **placeToOrder()** - сохранение в заказе товаров из корзины и их общей стоимости
- **clearOrder()** - очистка полей заказа после его завершения
- **setUserDataField(field: keyof IUserDataForm, value: string)** - сохранение данных из поля ввода
- **setUserContactsField(field: keyof IUserContactsForm, value: string)** - сохранение данных из поля ввода
- **validateUserData()** - валидация полей ввода
- **validateUserContacts()**  - валидация полей ввода


## Слой представления


### Класс Component

Абстрактный класс. Является родительским классом для всех компонентов представления, содержит методы необходимые для работы с DOM.
В конструктор принимает элемент HTML, который будет использоваться в качестве контейнера для компонента.
###### Методы:

- **toggleClass(element: HTMLElement, className: string, force?: boolean)** - добавляет или удаляет указанный класс элементу
- **setText(element: HTMLElement, value: unknown)** - устанавливает текстовое содержимое в переданный HTML - элемент
- **setDisabled(element: HTMLElement, state: boolean)** - делает переданный HTML - элемент неактивным
- **setHidden(element: HTMLElement)** - скрывает HTML - элемент
- **setVisible(element: HTMLElement)** - показывает HTML - элемент
- **setImage(element: HTMLImageElement, src: string, alt?: string)** - устанавливает изображение и его альтернативный текст
- **render(data?: `Partial<T>`)** - отображает переданные данные


### Класс ProductCard
Является дочерним классом Component.\
Отвечает за отображение карточки товара, устанавливает обложку, название, цену, категорию и описание товара. Содержит сеттеры и геттеры для работы с полями.

В конструктор принимает название блока, контейнер, в который будет помещена карточка и колбэк, который будет выполняться при клике на кнопку карточки.

###### Поля:

- **title: HTMLElement** - название товара
- **image: HTMLImageElement** - обложка товара
- **category: HTMLElement** - категория товара
- **price: HTMLElement** - цена товара
- **description: HTMLElement** - описание товара
- **button: HTMLButtonElement** - кнопка добавления товара в корзину
- **cartItemIndex?: HTMLElement** - порядковый номер товара в корзине

###### Методы:

- **changeButtonDescription(inCart: boolean)** - изменяет текст на кнопке карточки товара в зависимости от того, добавлен ли товар в корзину.

### Класс Page
Является дочерним классом Component.\
Отвечает за расстановку отображаемых элементов на странице, устанавливает элементы в предназначенные для них контейнеры, выводит обновленное значение счетчика товаров после добавления/удаления товара, позволяет блокировать прокрутку страницы, когда поверх нее вызвано модальное окно. Содержит сеттеры для работы с полями.

В конструктор принимает HTML элемент контейнера и экземпляр EventEmitter для инициализации событий.

###### Поля: 

- **counter: HTMLElement** - счетчик товаров в корзине
- **catalog: HTMLElement** - каталог товаров
- **wrapper: HTMLElement** - обертка страницы (для блокировки скролла)
- **shoppingCartIcon: HTMLElement** - элемент счетчика на главной странице


### Класс Popup
Является дочерним классом Component.\
Отображает универсальное модальное окно с кнопкой закрытия. Выводит внутри модального окна любой переданный контент.\
В конструктор принимает элемент контейнера и экземпляр класса `EventEmitter` для инициализации событий. Содержит сеттер для установки контента.

###### Поля: 

- **closeButton: HTMLButtonElement** - кнопка закрытия модального окна
- **content: HTMLElement** - наполнение попапа

###### Методы:
- **open()** - открытие модального окна
- **close()** - закрытие модального окна по нажатию на кнопку или вне зо**ны окна
- **handleESC(evt:KeyboardEvent)** - закрытие модального окна по на**жатию на ESC
- **render(data: IPopup)** - отображение модального окна


### Класс ShoppingCart
Является дочерним классом Component.\
Отображает корзину с ее содержимым.\ 

В конструктор принимает HTML-элемент контейнера и экземпляр EventEmitter для инициализации событий.

###### Поля:

- **list: HTMLElement** - контейнер для вывода товаров
- **total: HTMLElement** -  элемент для вывода общей стоимости то**варов в корзине
- **button: HTMLButtonElement** - кнопка оформления заказа

###### Методы:

- **resetCartView()** - удаление всех отображаемых карточек товаров из корзины после завершения заказа

### Класс Form

Представляет собой универсальный компонент формы, является родительским классом для всех форм приложения. Содержит сеттеры для установки значений полей.

В конструктор принимает HTML элемент формы и экземпляр EventEmitter для инициализации событий.

###### Поля:
- **submit: HTMLButtonElement** - кнопка сохранения формы
- **errors: HTMLElement** - вывод сообщений об ошибках валидации

###### Методы:

- **onInputChange()** - отслеживание изменений в поле ввода для генерации событий "changed"
- **render(state: `Partial<T>` & IFormState)** - отрисовывает и перерисовывает форму (например, когда нужно вывести сообщении об ошибке при невалидном тексте в поле ввода)


### Класс UserDataForm 

Является дочерним классом Form.
Отвечает за отображение формы ввода выбора способа оплаты и адреса доставки пользователя. Содержит сеттеры для работы с полями.

В конструктор принимает HTML-элемент формы и экземпляр EventEmitter для инициализации событий.

###### Поля:

- **payment: HTMLButtonElement[]** - кнопки выбора способа оплаты заказа
- **address: string** - адрес доставки


### Класс UserContactsForm 

Является дочерним классом Form.
Отвечает за отображение формы ввода электронной почты и номера телефона пользователя. Содержит сеттеры для работы с полями.

В конструктор принимает HTML-элемент формы и экземпляр EventEmitter для инициализации событий.

###### Поля:

- **email: string**  -   электронная почта пользователя
- **phone: string**  -   номер телефона пользователя


### Класс Success
Является дочерним классом Component.\
Предназначен для отображения сообщения об успешно завершенном заказе с итоговой суммой покупки, которое выводится в контент модального окна.

В конструктор принимает элемент, в который будет выведено сообщение об успешном заказе и функцию, выполняемую при нажатии на кнопку завершения заказа. Содержит сеттер total для установки значения списанных средств.

###### Поля:

- **close: HTMLButtonElement** - кнопка завершения заказа
- **total: HTMLElement** - количество списанных средств

## Слой коммуникации

### Класс CustomApi

Дополнение к базовому API для создания необходимых для взаимодействия с бэкендом методов, основанных на методах базового API.

В конструктор принимает адрес с которого происходит загрузка картинок, базовый URL и объект настроек.

###### Методы:
- **getProductList: () => Promise<`IProduct[]`>** - получить список товаров с сервера

- **getProductItem: (id: string) => Promise<`IProduct`>** - получить отдельный товар

- **orderProducts: (order: IOrder) => Promise<`IOrderResult`>** - отправить заказ на сервер 


## Взаимодействие компонентов

Архитектура проекта реализована в парадигме MVP и состоит из трех основных частей: 
1. Слой модели данных, в котором сосредоточена вся внутренняя логика работы с данными.
2. Слой представления, необходимый для работы с элементами разметки и отрисовки элементов на сайте.
3. Код, связывающий слой данных со слоем представления находится в файле index.ts и выполняет роль презентера.

Процессы в приложении организованы при помощи событийного подхода и реализованы при помощи брокера событий event emitter. Все обработчики событий находятся в файле index.ts.

##### Перечень событий, генерируемых в системе:

- `catalog:change` - событие генерируемое при подгрузке с сервера карточек товара

- `preview:change` - выбор карточки товара для отображения в модальном окне

- `modal:open` - открытие модального окна

- `modal:close` - закрытие модального окна

- `productCard:add` - добавление товара в корзину

- `productCard:remove` - удаление товара из корзины

- `shoppingCart:select` - вызов отображения корзины в модальном окне

- `shoppingCart:change` - изменение наполнения корзины

- `cardInShoppingCart:remove` - удаление товара в модальном окне корзины

- `goToOrder:submit` - подтверждение перехода к оформлению заказа

- `order.address:change`- изменение поля ввода адреса доставки

- `order.payment:change` - изменение поля ввода способа оплаты

- `order:submit` - сохранение данных в форме ввода способа оплаты и адреса доставки

- `contacts.email:change` - изменение поля ввода электронной почты

- `contacts.phone:change` - изменение поля ввода номера телефона

- `contacts:submit` - сохранение данных в форме ввода контактных данных покупателя

- `UserDataFormErrors:change` - изменение состояния валидации формы ввода способа оплаты и адреса доставки

- `UserContactsFormErrors:change` - изменение состояния валидации формы ввода электронной почты и номера телефона