# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
---
## Описание базового кода

#### 1. Класс `Api`

Представляет базовый класс для выполнения HTTP-запросов к внешнему API.

###### Конструктор принимает такие аргументы:
- `baseUrl: string` - базовый URL адрес для запросов. Строковый тип.
- `options: RequestInit` - настройки запроса по умолчанию. Объект типа RequestInit.

###### Используемые методы:

`handleResponse(response: Response): Promise<object>`

Защищенный метод. Принимает объект типа Response. Обрабатывает ответ от сервера и возвращает либо объект данных, либо отклоняет промис с сообщением об ошибке. 

`get(uri: string): Promise<object>`

Выполняет GET запрос к URI. Принимает URI в виде строки и возвращает промис с данными ответа.


`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>`

Выполняет POST запрос с переданным URI, данными и методом. Принимает URI в виде строки, объект данных и метод типа ApiPostMethods (строковый литерал). Возвращает промис, возвращающий объект.


#### 2. Класс `EventEmitter`
Представляет класс для управления событиями и подписчиками. Может установить и снять слушатели событий, вызвать слушателей при возникновении события.

###### Используемые методы:

- `on(eventName: EventName, callback: (event: T) => void): void`

Добавляет обработчик для указанного события.
Принимает два параметра: 
1. `eventName`: строка - имя события.
2. `callback`: функция обратного вызова, которая принимает один аргумент обобщенного типа `T`, где `T` ограничен типом `object`.
Возвращает тип `void`.


- `off(eventName: EventName, callback: Subscriber): void` 

Удаляет обработчик для указанного события.
Принимает два параметра:
1. `eventName`: строка - имя события.
2. `callback`: объект типа `Subscriber` - это обработчик события, который должен быть удален.
Возвращает тип `void`.

- `emit(eventName: string, data?: T): void` 

Вызывает указанное событие, сообщая всем, кто на него подписан, о его наступлении. При этом могут передаваться какие-нибудь данные.
Принимает два параметра:
1. `eventName`: строка - имя события.
2. `data`: объект типа `T` или `undefined` (необязательный параметр) - данные, необходимые для вызова события.
Возвращает тип `void`.

- `onAll(callback: (event: EmitterEvent) => void): void` 

Добавляет обработчик, который будет вызываться для всех событий.
Принимает функцию обратного вызова, которая принимает объект типа `EmitterEvent`.
Возвращает тип `void`.

- `offAll(): void` 

Удаляет все обработчики событий.
Возвращает тип `void`.

`trigger(eventName: string, context?: Partial<T>): (event: object = {}) => void` 

Создает функцию-триггер, которая вызывает указанное событие с указанным контекстом, когда она вызывается.
Принимает два параметра:
1. `eventName`: строка - имя события.
2. `context`:  объект типа `Partial<T>` (может содержать не все свойства типа `T`) или `undefined` (необязательный параметр) - контекст, который связан с событием. 
Возвращает функцию обратного вызова, которая принимает аргумент типа `object` (но имеет значение по умолчанию `{}` и не возвращает ничего (тип `void`).

---
## Описание данных и типов данных

Данные, используемые в проекте, представлены интерфейсами IProduct и IOrder. Первый интерфейс описывает характеристики конкретного товара, получаемые с сервера, второй описывает информацию об оформленном заказе для отправки на сервер.

#### Интерфейс IProduct 

Представляет конкретный товар доступный для приобретения в интернет-магазине, содержит все данные, необходимые для описания товара. 

###### Свойства: 

- **id**: `string` уникальный идентификатор товара
- **category**: `string` - категория товара 
- **title**: `string` - название товара
- **description**: `string` - описание товара
- **image**: `string`- ссылка на изображение товара
- **price**: `number|null` -  цена товара
- **inCart?**:`boolean` - добавлен ли товар в корзину


#### Интерфейс IOrder

Представляет объект заказа и содержит все необходимые для заказа данные. Необходим для формирования заказа и отправки его на сервер.

###### Свойства:

- **payment**: `string`  -  метод оплаты заказа.
- **email**: `string`  -  электронная почта пользователя.
- **phone**: `string`  -  номер телефона пользователя.
- **address**: `string`  - адрес доставки.
- **total**: `number`  - общая стоимость заказа.
- **items**: `string[]` - массив товаров, составляющих заказ.

## Слой данных 

### Класс ModelData

Содержит основную логику работы с данными в приложении. Хранит массив товаров для каталога и массив товаров корзины, методы добавления и удаления товара, методы для установки каталога и очистки корзины.

Свойства:

- **catalog:** `IProduct[]` - массив товаров каталога
- **shoppingCart:** `string[]` - массив товаров в корзине
- **order:** `IOrder | null` - текущий заказ пользователя или `null`, если заказ не оформлен

###### Методы: 

- setCatalog(items: IProduct[]) - позволяет установить каталог товаров
- setPreview(item: IProduct) - сохраняет id выбранной карточки
- clearShoppingCart() - позволяет очистить корзину после завершения заказа
- getTotal() - позволяет получить итоговую сумму заказа
- validateOrder() - позволяет валидировать заказ 


## Слой представления


### Класс Component

Абстрактный класс. Является родительским классом для всех компонентов представления, содержит методы необходимые для работы с DOM.
В конструктор принимает элемент HTML, который будет использоваться в качестве контейнера для компонента.
###### Методы:

- toggleClass(element: HTMLElement, className: string, force?: boolean) - добавляет или удаляет указанный класс CSS (className) у элемента (element), в зависимости от значения параметра force
- setText(element: HTMLElement, value: unknown) - устанавливает текстовое содержимое в переданный HTML - элемент
- setDisabled(element: HTMLElement, state: boolean) - делает переданный HTML - элемент неактивным
- setHidden(element: HTMLElement) - скрывает HTML - элемент
- setVisible(element: HTMLElement) - показывает HTML - элемент
- setImage(element: HTMLImageElement, src: string, alt?: string) - устанавливает изображение и его альтернативный текст
- `render(data?: Partial<T>): HTMLElement` - отображает переданные данные


### Класс ProductCard

Отвечает за отображение карточки товара, устанавливает обложку, название, цену, категорию и описание товара. Содержит сеттеры и геттеры для работы с полями.

В конструктор принимает название блока, контейнер, в который будет помещена карточка и колбэк, который будет выполняться при клике на кнопку карточки.
###### Свойства:

title: HTMLElement - название товара
price: HTMLElement - цена товара
cathegory: HTMLElement - категория товара
image: HTMLImageElement - обложка товара
description: HTMLElement - описание товара
button?: HTMLButtonElement - кнопка добавления товара в корзину

### Класс Popup

Отображает универсальное модальное окно с кнопкой сабмита и кнопкой закрытия. Выводит внутри модального окна любой переданный контент.\
В конструктор принимает отображаемый HTML-элемент и экземпляр класса `EventEmitter` для инициализации событий.

###### Свойства: 

closeButton: HTMLButtonElement - кнопка закрытия модального окна
content: HTMLElement - наполнение попапа

###### Методы:
- open() - открытие модального окна
- close() - закрытие модального окна
- render(data: IPopup): HTMLElement - отрисовка модального окна

### Класс Page

Отвечает за расстановку отображаемых элементов на странице, устанавливает элементы в предназначенные для них контейнеры, выводит обновленное значение счетчика товаров после добавления/удаления товара, позволяет блокировать прокрутку страницы, когда поверх нее вызвано модальное окно.

В конструктор принимает HTML элемент контейнера и экземпляр EventEmitter для инициализации событий.

###### Свойства: 

counter: `number` - счетчик, значение которого выводится у иконки корзины на главной странице
catalog: `HTMLElement[]` -  каталог товаров
locked: `boolean` - блокировка прокрутки страницы при появлении модального окна


### Класс ShoppingCart

Отображает корзину с ее содержимым. 
В конструктор принимает HTML- элемент контейнер и экземпляр EventEmitter для инициализации событий.

###### Свойства:

items: `HTMLElement[]` - список товаров в корзине
total: `number` - итоговая стоимость покупки
button: `HTMLElement` - кнопка оформления заказа

### Класс Form

Представляет собой универсальный компонент формы, в который подставляется шаблон необходимой формы.

В конструктор принимает элемент HTML-формы и экземпляр EventEmitter для инициализации событий.

###### Свойства:

button: HTMLButtonElement - кнопка отправки формы
formErrors: HTMLElement - сообщения об ошибках при валидации

###### Методы:

`onInputChange()` - отслеживание изменений в поле ввода для генерации событий "changed"
`render(state: Partial<T> & IFormState)`-  отрисовывает и перерисовывает форму (например, когда нужно вывести сообщении об ошибке при невалидном поле )


### Класс UserDataForm 

Является дочерним классом класса Form.
Отвечает за отображение формы ввода выбора способа оплаты и адреса доставки пользователя. При открытии соответствующего модального окна создается экземпляр класса.
###### Поля класса:

- **payment**: `EPaymentMethod`  -  метод оплаты заказа
- **address**: `string`  - адрес доставки


### Класс UserContactsForm 

Является дочерним классом класса Form.
Отвечает за отображение формы ввода электронной почты и номера телефона пользователя. При открытии соответствующего модального окна создается экземпляр класса.
###### Поля класса:

- **email**: `string`  -  электронная почта пользователя
- **phone**: `string`  -  номер телефона пользователя


### Класс Success

Предназначен для отображения сообщения об успешно завершенном заказе с итоговой суммой покупки, которое выводится в контент модального окна.

В конструктор принимает элемент, в который будет выведено сообщение об успешном заказе и функцию, выполняемую при нажатии на кнопку завершения заказа.

###### Поля класса:

close: HTMLButtonElement - кнопка завершения заказа??????????????????????

## Слой коммуникации

### Класс CustomApi

Дополнение к базовому API для создания необходимых для взаимодействия с бэкендом методов, основанных на методах базового API.

В конструктор принимает адрес с которого происходит загрузка картинок, базовый URL и объект настроек.

###### Методы:
- `getProductList: () => Promise<IProduct[]>` - позволяет получить список товаров с сервера

- `getProductItem: (id: string) => Promise<IProduct>` -  позволяет получить отдельный товар

- `orderProducts: (order: IOrder) => Promise<IOrderResult>` - позволяет отправить на сервер сформированный заказ



## Взаимодействие компонентов

Архитектура проекта реализована в парадигме MVP и состоит из трех основных частей: 
1. Слой модели данных, в котором сосредоточена вся внутренняя логика работы с данными.
2. Слой представления, необходимый для работы с элементами разметки и отрисовки элементов на сайте.
3. Код, связывающий слой данных со слоем представления находится в файле index.ts и выполняет роль презентера.

Процессы в приложении организованы при помощи событийного подхода и реализованы при помощи брокера событий event emitter. Все обработчики событий находятся в файле index.ts.


